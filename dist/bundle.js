var AwsFileUpload;AwsFileUpload=(()=>{"use strict";var t={138:(t,e,o)=>{o.d(e,{default:()=>p});const i={0:"Invalid option parameter it must be an Object",1:"Invalid File",2:"Invalid Response format, response format must be \n        {\n            success : true|false,\n            data : {\n                url : String\n            }\n        }\n    ",3:"sined Url not found in response",4:"MultipartUpload: upload id not found in response",5:"Failed to upload file",6:"MultipartUpload: uploadIdRequest not provided.",7:"MultipartUpload: uploadIdRequest url not provided.",8:"MultipartUpload: upload id not found in response",9:"File name is not provided.",10:"MultipartUpload: failed to complete file upload.",11:"MultipartUpload: The minimal multipart upload size is 5Mb (chunkSize >= 5MB).",12:"MultipartUpload: multipartsignedUrlRequest.url -> Url is missing"};class s{constructor(t){this.options=t,this.isUploadModeMultipart=!1,this.init().catch((t=>{var e;t.code&&i[t.code]?(t.code,e=t.code,t.response):e=null,this.options.onError?this.options.onError({message:i[t.code],response:t.response,code:t.code}):(console.group("AwsFileUpload"),console.error(t.code?i[t.code]:t),console.error(`errorCode: ${e}`),console.groupEnd())}))}fetchSignedUrl(){var t,e,o;return e=(t=this.isUploadModeMultipart&&this.options.multipartsignedUrlRequest?Object.assign({},this.options.multipartsignedUrlRequest):Object.assign({},this.options.signedUrlRequest)).url,o=t.body||{},this.isUploadModeMultipart&&(o.partNumber=this.partNumber,o.uploadId=this.uploadId),o.fileName=this.options.fileName,t.body=JSON.stringify(o),delete t.url,fetch(e,t)}fetchUploadId(){var t=Object.assign({},this.options.uploadIdRequest);let e=t.body||{};return e.fileName=this.options.fileName,t.body=JSON.stringify(e),delete t.url,fetch(this.options.uploadIdRequest.url,t)}completeMultipart(t){var e=Object.assign({},this.options.completeMultipartRequest);let o=e.body||{};return o.fileName=this.options.fileName,o.uploadId=this.uploadId,o.parts=t,e.body=JSON.stringify(o),delete e.url,fetch(this.options.completeMultipartRequest.url,e)}async init(){var t,e,o;if(!(this.options instanceof Object))throw{code:0};if(!(this.options.file instanceof File))throw{code:1};if(!this.options.fileName)throw{code:9};if(this.options.signedUrlRequest.headers||(this.options.signedUrlRequest.headers={}),this.options.signedUrlRequest.headers["Content-type"]||(this.options.signedUrlRequest.headers["Content-type"]="application/json"),this.evaluateIsMultipart(),this.isUploadModeMultipart){if(!this.options.uploadIdRequest)throw{code:6};if(!this.options.uploadIdRequest.url)throw{code:7};if(this.options.uploadIdRequest.headers||(this.options.uploadIdRequest.headers={}),this.options.uploadIdRequest.headers["Content-type"]||(this.options.uploadIdRequest.headers["Content-type"]="application/json"),this.options.multipartsignedUrlRequest){if(!this.options.multipartsignedUrlRequest.url)throw{code:12};this.options.multipartsignedUrlRequest.headers||(this.options.multipartsignedUrlRequest.headers={}),this.options.multipartsignedUrlRequest.headers["Content-type"]||(this.options.multipartsignedUrlRequest.headers["Content-type"]="application/json")}if(!this.options.completeMultipartRequest)throw{code:6};if(!this.options.completeMultipartRequest.url)throw{code:7};this.options.completeMultipartRequest.headers||(this.options.completeMultipartRequest.headers={}),this.options.completeMultipartRequest.headers["Content-type"]||(this.options.completeMultipartRequest.headers["Content-type"]="application/json");let i,s,p,a=Math.floor(this.options.file.size/this.options.chunkSize)+1,n=[],r=[];if(200!=(t=await this.fetchUploadId()).status)throw{code:8,response:t};if(e=await t.json(),this.uploadId=e.data.uploadId,!this.uploadId)throw{code:4};for(let e=1;e<a+1;e++){if(i=(e-1)*this.options.chunkSize,s=e*this.options.chunkSize,p=e<a?this.options.file.slice(i,s):this.options.file.slice(i),this.partNumber=e,t=await this.fetchSignedUrl(),!(o=await t.json()).data)throw{code:2,response:t};if(!o.data.url)throw{code:3,response:t};if(this.signedUrl=o.data.url,200!=(t=await this.uploadFile(p)).status)throw{code:5,response:t};n.push(t),r.push({ETag:t.headers.get("etag"),PartNumber:e,Size:p.size})}if(200!=(t=await this.completeMultipart(r)).status)throw{code:10,response:t};this.options.onSuccess&&this.options.onSuccess(t,r,n)}else{if(t=await this.fetchSignedUrl(),!(o=await t.json()).data)throw{code:2,response:t};if(!o.data.url)throw{code:3,response:t};if(this.signedUrl=o.data.url,200!=(t=await this.uploadFile(this.options.file)).status)throw{code:5,response:t};this.options.onSuccess&&this.options.onSuccess(t)}}uploadFile(t){var e=new Headers;e.append("Content-Type",this.options.file.type);var o={method:"PUT",headers:e,body:t,redirect:"follow"};return fetch(this.signedUrl,o)}evaluateIsMultipart(){if("auto"==this.options.multipartUpload||1==this.options.multipartUpload){if(this.options.chunkSize&&this.options.chunkSize<6e6)throw{code:11};this.options.chunkSize=this.options.chunkSize||1e7,this.isUploadModeMultipart="auto"!=this.options.multipartUpload||this.options.file.size/this.options.chunkSize>1}}}function p(t){new s(t)}}},e={};function o(i){if(e[i])return e[i].exports;var s=e[i]={exports:{}};return t[i](s,s.exports,o),s.exports}return o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o(138)})().default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Bd3NGaWxlVXBsb2FkLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL0F3c0ZpbGVVcGxvYWQvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vQXdzRmlsZVVwbG9hZC93ZWJwYWNrL3N0YXJ0dXAiLCJ3ZWJwYWNrOi8vQXdzRmlsZVVwbG9hZC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vQXdzRmlsZVVwbG9hZC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIl0sIm5hbWVzIjpbIkVycm9ycyIsIjAiLCIxIiwiMiIsIjMiLCI0IiwiNSIsIjYiLCI3IiwiOCIsIjkiLCIxMCIsIjExIiwiMTIiLCJfQXdzRmlsZVVwbG9hZCIsIm9wdGlvbnMiLCJ0aGlzIiwiaXNVcGxvYWRNb2RlTXVsdGlwYXJ0IiwiaW5pdCIsImNhdGNoIiwiZXJyb3JzIiwiY29kZSIsInJlc3BvbnNlIiwib25FcnJvciIsIm1lc3NhZ2UiLCJjb25zb2xlIiwiZ3JvdXAiLCJlcnJvciIsImdyb3VwRW5kIiwicmVxdWVzdE9wdGlvbnMiLCJ1cmwiLCJib2R5IiwibXVsdGlwYXJ0c2lnbmVkVXJsUmVxdWVzdCIsIk9iamVjdCIsImFzc2lnbiIsInNpZ25lZFVybFJlcXVlc3QiLCJwYXJ0TnVtYmVyIiwidXBsb2FkSWQiLCJmaWxlTmFtZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJmZXRjaCIsInVwbG9hZElkUmVxdWVzdCIsInVwbG9hZFBhcnRzQXJyYXkiLCJjb21wbGV0ZU11bHRpcGFydFJlcXVlc3QiLCJwYXJ0cyIsImRhdGEiLCJmaWxlIiwiRmlsZSIsImhlYWRlcnMiLCJldmFsdWF0ZUlzTXVsdGlwYXJ0Iiwic3RhcnQiLCJlbmQiLCJibG9iIiwibnVtT2ZDaHVua3MiLCJNYXRoIiwiZmxvb3IiLCJzaXplIiwiY2h1bmtTaXplIiwicmVzcG9uc2VBcnJheSIsImZldGNoVXBsb2FkSWQiLCJzdGF0dXMiLCJqc29uIiwiaW5kZXgiLCJzbGljZSIsImZldGNoU2lnbmVkVXJsIiwic2lnbmVkVXJsIiwidXBsb2FkRmlsZSIsInB1c2giLCJFVGFnIiwiZ2V0IiwiUGFydE51bWJlciIsIlNpemUiLCJjb21wbGV0ZU11bHRpcGFydCIsIm9uU3VjY2VzcyIsIm15SGVhZGVycyIsIkhlYWRlcnMiLCJhcHBlbmQiLCJ0eXBlIiwibWV0aG9kIiwicmVkaXJlY3QiLCJtdWx0aXBhcnRVcGxvYWQiLCJBd3NGaWxlVXBsb2FkIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJkIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIl0sIm1hcHBpbmdzIjoiK0ZBU0EsTUFBTUEsRUFBUyxDQUNYQyxFQUFJLGdEQUNKQyxFQUFJLGVBQ0pDLEVBQUksc0xBUUpDLEVBQUksa0NBQ0pDLEVBQUksbURBQ0pDLEVBQUksd0JBQ0pDLEVBQUksaURBQ0pDLEVBQUkscURBQ0pDLEVBQUksbURBQ0pDLEVBQUksNkJBQ0pDLEdBQUssbURBQ0xDLEdBQUssZ0ZBQ0xDLEdBQUssb0VBTVQsTUFBTUMsRUFDRixZQUFZQyxHQUNSQyxLQUFLRCxRQUFVQSxFQUNmQyxLQUFLQyx1QkFBd0IsRUFDN0JELEtBQUtFLE9BQ0FDLE9BQU9DLElBQ0osSUFBdUJDLEVBQ25CRCxFQUFPQyxNQUFRckIsRUFBT29CLEVBQU9DLE9BQ1pELEVBQU9DLEtBQ3hCQSxFQUFPRCxFQUFPQyxLQUNIRCxFQUFPRSxVQUdsQkQsRUFBTyxLQUdQTCxLQUFLRCxRQUFRUSxRQUNiUCxLQUFLRCxRQUFRUSxRQUFRLENBQ2pCQyxRQUFTeEIsRUFBT29CLEVBQU9DLE1BQ3ZCQyxTQUFVRixFQUFPRSxTQUNqQkQsS0FBTUQsRUFBT0MsUUFHakJJLFFBQVFDLE1BQU0saUJBQ2RELFFBQVFFLE1BQU1QLEVBQU9DLEtBQU9yQixFQUFPb0IsRUFBT0MsTUFBUUQsR0FDbERLLFFBQVFFLE1BQU0sY0FBY04sS0FDNUJJLFFBQVFHLGVBS3hCLGlCQUVJLElBQUlDLEVBQWdCQyxFQUFLQyxFQVd6QixPQVRBRCxHQURBRCxFQUFpQmIsS0FBS0MsdUJBQTBCRCxLQUFLRCxRQUFRaUIsMEJBQTRCQyxPQUFPQyxPQUFPLEdBQUlsQixLQUFLRCxRQUFRaUIsMkJBQTZCQyxPQUFPQyxPQUFPLEdBQUlsQixLQUFLRCxRQUFRb0IsbUJBQy9KTCxJQUNyQkMsRUFBT0YsRUFBZUUsTUFBUSxHQUMxQmYsS0FBS0Msd0JBQ0xjLEVBQUtLLFdBQWFwQixLQUFLb0IsV0FDdkJMLEVBQUtNLFNBQVdyQixLQUFLcUIsVUFFekJOLEVBQUtPLFNBQVd0QixLQUFLRCxRQUFRdUIsU0FDN0JULEVBQWVFLEtBQU9RLEtBQUtDLFVBQVVULFVBQzlCRixFQUFlQyxJQUNmVyxNQUFNWCxFQUFLRCxHQUd0QixnQkFDSSxJQUFJQSxFQUFpQkksT0FBT0MsT0FBTyxHQUFJbEIsS0FBS0QsUUFBUTJCLGlCQUNwRCxJQUFJWCxFQUFPRixFQUFlRSxNQUFRLEdBSWxDLE9BSEFBLEVBQUtPLFNBQVd0QixLQUFLRCxRQUFRdUIsU0FDN0JULEVBQWVFLEtBQU9RLEtBQUtDLFVBQVVULFVBQzlCRixFQUFlQyxJQUNmVyxNQUFNekIsS0FBS0QsUUFBUTJCLGdCQUFnQlosSUFBS0QsR0FHbkQsa0JBQWtCYyxHQUNkLElBQUlkLEVBQWlCSSxPQUFPQyxPQUFPLEdBQUlsQixLQUFLRCxRQUFRNkIsMEJBQ3BELElBQUliLEVBQU9GLEVBQWVFLE1BQVEsR0FNbEMsT0FMQUEsRUFBS08sU0FBV3RCLEtBQUtELFFBQVF1QixTQUM3QlAsRUFBS00sU0FBV3JCLEtBQUtxQixTQUNyQk4sRUFBS2MsTUFBUUYsRUFDYmQsRUFBZUUsS0FBT1EsS0FBS0MsVUFBVVQsVUFDOUJGLEVBQWVDLElBQ2ZXLE1BQU16QixLQUFLRCxRQUFRNkIseUJBQXlCZCxJQUFLRCxHQUc1RCxhQUNJLElBQUlQLEVBQVV3QixFQUFNZixFQUNwQixLQUFNZixLQUFLRCxtQkFBbUJrQixRQUFTLEtBQU0sQ0FBRVosS0FBTSxHQUNyRCxLQUFNTCxLQUFLRCxRQUFRZ0MsZ0JBQWdCQyxNQUFPLEtBQU0sQ0FBRTNCLEtBQU0sR0FDeEQsSUFBS0wsS0FBS0QsUUFBUXVCLFNBQVUsS0FBTSxDQUFFakIsS0FBTSxHQU8xQyxHQU5LTCxLQUFLRCxRQUFRb0IsaUJBQWlCYyxVQUFTakMsS0FBS0QsUUFBUW9CLGlCQUFpQmMsUUFBVSxJQUMvRWpDLEtBQUtELFFBQVFvQixpQkFBaUJjLFFBQVEsa0JBQWlCakMsS0FBS0QsUUFBUW9CLGlCQUFpQmMsUUFBUSxnQkFBa0Isb0JBQ3BIakMsS0FBS2tDLHNCQUlEbEMsS0FBS0Msc0JBQXVCLENBQzVCLElBQUlELEtBQUtELFFBQVEyQixnQkFBaUIsS0FBTSxDQUFDckIsS0FBTyxHQUNoRCxJQUFLTCxLQUFLRCxRQUFRMkIsZ0JBQWdCWixJQUFLLEtBQU0sQ0FBRVQsS0FBTSxHQUlyRCxHQUhLTCxLQUFLRCxRQUFRMkIsZ0JBQWdCTyxVQUFTakMsS0FBS0QsUUFBUTJCLGdCQUFnQk8sUUFBVSxJQUM3RWpDLEtBQUtELFFBQVEyQixnQkFBZ0JPLFFBQVEsa0JBQWlCakMsS0FBS0QsUUFBUTJCLGdCQUFnQk8sUUFBUSxnQkFBa0Isb0JBRS9HakMsS0FBS0QsUUFBUWlCLDBCQUEwQixDQUN0QyxJQUFJaEIsS0FBS0QsUUFBUWlCLDBCQUEwQkYsSUFBSyxLQUFNLENBQUVULEtBQU0sSUFDekRMLEtBQUtELFFBQVFpQiwwQkFBMEJpQixVQUFTakMsS0FBS0QsUUFBUWlCLDBCQUEwQmlCLFFBQVUsSUFDakdqQyxLQUFLRCxRQUFRaUIsMEJBQTBCaUIsUUFBUSxrQkFBaUJqQyxLQUFLRCxRQUFRaUIsMEJBQTBCaUIsUUFBUSxnQkFBa0Isb0JBRzFJLElBQUlqQyxLQUFLRCxRQUFRNkIseUJBQTBCLEtBQU0sQ0FBQ3ZCLEtBQU8sR0FDekQsSUFBS0wsS0FBS0QsUUFBUTZCLHlCQUF5QmQsSUFBSyxLQUFNLENBQUVULEtBQU0sR0FDekRMLEtBQUtELFFBQVE2Qix5QkFBeUJLLFVBQVNqQyxLQUFLRCxRQUFRNkIseUJBQXlCSyxRQUFVLElBQy9GakMsS0FBS0QsUUFBUTZCLHlCQUF5QkssUUFBUSxrQkFBaUJqQyxLQUFLRCxRQUFRNkIseUJBQXlCSyxRQUFRLGdCQUFrQixvQkFFcEksSUFHSUUsRUFBT0MsRUFBS0MsRUFIWkMsRUFBY0MsS0FBS0MsTUFBTXhDLEtBQUtELFFBQVFnQyxLQUFLVSxLQUFPekMsS0FBS0QsUUFBUTJDLFdBQWEsRUFDNUVDLEVBQWdCLEdBQ2hCaEIsRUFBbUIsR0FJdkIsR0FBdUIsTUFEdkJyQixRQUFpQk4sS0FBSzRDLGlCQUNUQyxPQUFlLEtBQU0sQ0FBRXhDLEtBQU0sRUFBR0MsU0FBVUEsR0FJdkQsR0FIQXdCLFFBQWF4QixFQUFTd0MsT0FDdEI5QyxLQUFLcUIsU0FBV1MsRUFBS0EsS0FBS1QsVUFFckJyQixLQUFLcUIsU0FBVSxLQUFNLENBQUVoQixLQUFNLEdBQ2xDLElBQUssSUFBSTBDLEVBQVEsRUFBR0EsRUFBUVQsRUFBYyxFQUFHUyxJQUFTLENBT2xELEdBTkFaLEdBQVNZLEVBQVEsR0FBSy9DLEtBQUtELFFBQVEyQyxVQUNuQ04sRUFBTVcsRUFBUS9DLEtBQUtELFFBQVEyQyxVQUMzQkwsRUFBT1UsRUFBUVQsRUFBY3RDLEtBQUtELFFBQVFnQyxLQUFLaUIsTUFBTWIsRUFBT0MsR0FBT3BDLEtBQUtELFFBQVFnQyxLQUFLaUIsTUFBTWIsR0FDM0ZuQyxLQUFLb0IsV0FBYTJCLEVBQ2xCekMsUUFBaUJOLEtBQUtpRCxtQkFDdEJsQyxRQUFhVCxFQUFTd0MsUUFDWmhCLEtBQU0sS0FBTSxDQUFFekIsS0FBTSxFQUFHQyxTQUFVQSxHQUMzQyxJQUFLUyxFQUFLZSxLQUFLaEIsSUFBSyxLQUFNLENBQUVULEtBQU0sRUFBR0MsU0FBVUEsR0FHL0MsR0FGQU4sS0FBS2tELFVBQVluQyxFQUFLZSxLQUFLaEIsSUFFSixNQUR2QlIsUUFBaUJOLEtBQUttRCxXQUFXZCxJQUNwQlEsT0FBZSxLQUFNLENBQUV4QyxLQUFNLEVBQUdDLFNBQVVBLEdBQ3ZEcUMsRUFBY1MsS0FBSzlDLEdBQ25CcUIsRUFBaUJ5QixLQUFLLENBRWxCQyxLQUFNL0MsRUFBUzJCLFFBQVFxQixJQUFJLFFBQzNCQyxXQUFZUixFQUNaUyxLQUFNbkIsRUFBS0ksT0FJbkIsR0FBdUIsTUFEdkJuQyxRQUFpQk4sS0FBS3lELGtCQUFrQjlCLElBQzNCa0IsT0FBZSxLQUFNLENBQUV4QyxLQUFNLEdBQUlDLFNBQVVBLEdBQ3BETixLQUFLRCxRQUFRMkQsV0FBVzFELEtBQUtELFFBQVEyRCxVQUFVcEQsRUFBVXFCLEVBQWtCZ0IsT0FDNUUsQ0FHSCxHQUZBckMsUUFBaUJOLEtBQUtpRCxtQkFDdEJsQyxRQUFhVCxFQUFTd0MsUUFDWmhCLEtBQU0sS0FBTSxDQUFFekIsS0FBTSxFQUFHQyxTQUFVQSxHQUMzQyxJQUFLUyxFQUFLZSxLQUFLaEIsSUFBSyxLQUFNLENBQUVULEtBQU0sRUFBR0MsU0FBVUEsR0FHL0MsR0FGQU4sS0FBS2tELFVBQVluQyxFQUFLZSxLQUFLaEIsSUFFSixNQUR2QlIsUUFBaUJOLEtBQUttRCxXQUFXbkQsS0FBS0QsUUFBUWdDLE9BQ2pDYyxPQUFlLEtBQU0sQ0FBRXhDLEtBQU0sRUFBR0MsU0FBVUEsR0FDbkROLEtBQUtELFFBQVEyRCxXQUFXMUQsS0FBS0QsUUFBUTJELFVBQVVwRCxJQU0zRCxXQUFXeUIsR0FDUCxJQUFJNEIsRUFBWSxJQUFJQyxRQUNwQkQsRUFBVUUsT0FBTyxlQUFnQjdELEtBQUtELFFBQVFnQyxLQUFLK0IsTUFDbkQsSUFBSWpELEVBQWlCLENBQ2pCa0QsT0FBUSxNQUNSOUIsUUFBUzBCLEVBQ1Q1QyxLQUFNZ0IsRUFDTmlDLFNBQVUsVUFFZCxPQUFPdkMsTUFBTXpCLEtBQUtrRCxVQUFXckMsR0FJakMsc0JBQ0ksR0FBbUMsUUFBaENiLEtBQUtELFFBQVFrRSxpQkFBNkQsR0FBaENqRSxLQUFLRCxRQUFRa0UsZ0JBQXdCLENBQzlFLEdBQUlqRSxLQUFLRCxRQUFRMkMsV0FBYTFDLEtBQUtELFFBQVEyQyxVQUFZLElBQVMsS0FBTSxDQUFFckMsS0FBTSxJQUM5RUwsS0FBS0QsUUFBUTJDLFVBQVkxQyxLQUFLRCxRQUFRMkMsV0FBYSxJQUNuRDFDLEtBQUtDLHNCQUF3RCxRQUFoQ0QsS0FBS0QsUUFBUWtFLGlCQUE2QmpFLEtBQUtELFFBQVFnQyxLQUFLVSxLQUFLekMsS0FBS0QsUUFBUTJDLFVBQWEsSUFvQnJILFNBQVN3QixFQUFjbkUsR0FDbEMsSUFBSUQsRUFBZUMsTUN2Tm5Cb0UsRUFBMkIsR0FHL0IsU0FBU0MsRUFBb0JDLEdBRTVCLEdBQUdGLEVBQXlCRSxHQUMzQixPQUFPRixFQUF5QkUsR0FBVUMsUUFHM0MsSUFBSUMsRUFBU0osRUFBeUJFLEdBQVksQ0FHakRDLFFBQVMsSUFPVixPQUhBRSxFQUFvQkgsR0FBVUUsRUFBUUEsRUFBT0QsUUFBU0YsR0FHL0NHLEVBQU9ELFFDakJmLE9DRkFGLEVBQW9CSyxFQUFJLENBQUNILEVBQVNJLEtBQ2pDLElBQUksSUFBSUMsS0FBT0QsRUFDWE4sRUFBb0JRLEVBQUVGLEVBQVlDLEtBQVNQLEVBQW9CUSxFQUFFTixFQUFTSyxJQUM1RTFELE9BQU80RCxlQUFlUCxFQUFTSyxFQUFLLENBQUVHLFlBQVksRUFBTXhCLElBQUtvQixFQUFXQyxNQ0ozRVAsRUFBb0JRLEVBQUksQ0FBQ0csRUFBS0MsSUFBUy9ELE9BQU9nRSxVQUFVQyxlQUFlQyxLQUFLSixFQUFLQyxHRkcxRVosRUFBb0IsTSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogVG8gdXBsb2FkIGZpbGUgb24gYXdzIHMzXHJcbiAqIEBsaW5rICAgd3d3LnJhZ2FzYXZlLmNvbVxyXG4gKiBAZmlsZSAgIGluZGV4LmpzXHJcbiAqIEBhdXRob3IgUmFodWwgVmFybWFcclxuICogQHNpbmNlICAwNy4xMi4yMDIwXHJcbiAqL1xyXG5cclxuXHJcbmNvbnN0IEVycm9ycyA9IHtcclxuICAgIDAgOiBgSW52YWxpZCBvcHRpb24gcGFyYW1ldGVyIGl0IG11c3QgYmUgYW4gT2JqZWN0YCxcclxuICAgIDEgOiBgSW52YWxpZCBGaWxlYCxcclxuICAgIDIgOiBgSW52YWxpZCBSZXNwb25zZSBmb3JtYXQsIHJlc3BvbnNlIGZvcm1hdCBtdXN0IGJlIFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3VjY2VzcyA6IHRydWV8ZmFsc2UsXHJcbiAgICAgICAgICAgIGRhdGEgOiB7XHJcbiAgICAgICAgICAgICAgICB1cmwgOiBTdHJpbmdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIGAsXHJcbiAgICAzIDogYHNpbmVkIFVybCBub3QgZm91bmQgaW4gcmVzcG9uc2VgLFxyXG4gICAgNCA6IGBNdWx0aXBhcnRVcGxvYWQ6IHVwbG9hZCBpZCBub3QgZm91bmQgaW4gcmVzcG9uc2VgLFxyXG4gICAgNSA6IGBGYWlsZWQgdG8gdXBsb2FkIGZpbGVgLFxyXG4gICAgNiA6IGBNdWx0aXBhcnRVcGxvYWQ6IHVwbG9hZElkUmVxdWVzdCBub3QgcHJvdmlkZWQuYCxcclxuICAgIDcgOiBgTXVsdGlwYXJ0VXBsb2FkOiB1cGxvYWRJZFJlcXVlc3QgdXJsIG5vdCBwcm92aWRlZC5gLFxyXG4gICAgOCA6IGBNdWx0aXBhcnRVcGxvYWQ6IHVwbG9hZCBpZCBub3QgZm91bmQgaW4gcmVzcG9uc2VgLFxyXG4gICAgOSA6IGBGaWxlIG5hbWUgaXMgbm90IHByb3ZpZGVkLmAsXHJcbiAgICAxMCA6IGBNdWx0aXBhcnRVcGxvYWQ6IGZhaWxlZCB0byBjb21wbGV0ZSBmaWxlIHVwbG9hZC5gLFxyXG4gICAgMTEgOiBgTXVsdGlwYXJ0VXBsb2FkOiBUaGUgbWluaW1hbCBtdWx0aXBhcnQgdXBsb2FkIHNpemUgaXMgNU1iIChjaHVua1NpemUgPj0gNU1CKS5gLFxyXG4gICAgMTIgOiBgTXVsdGlwYXJ0VXBsb2FkOiBtdWx0aXBhcnRzaWduZWRVcmxSZXF1ZXN0LnVybCAtPiBVcmwgaXMgbWlzc2luZ2BcclxufTtcclxuXHJcblxyXG5cclxuXHJcbmNsYXNzIF9Bd3NGaWxlVXBsb2FkIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgICAgIHRoaXMuaXNVcGxvYWRNb2RlTXVsdGlwYXJ0ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5pbml0KClcclxuICAgICAgICAgICAgLmNhdGNoKChlcnJvcnMpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlLCByZXNwb25zZSwgY29kZVxyXG4gICAgICAgICAgICAgICAgaWYgKGVycm9ycy5jb2RlICYmIEVycm9yc1tlcnJvcnMuY29kZV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gRXJyb3JzW2Vycm9ycy5jb2RlXTtcclxuICAgICAgICAgICAgICAgICAgICBjb2RlID0gZXJyb3JzLmNvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBlcnJvcnMucmVzcG9uc2UgfHwgbnVsbFxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gZXJyb3JzO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvZGUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gbnVsbFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5vbkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLm9uRXJyb3Ioe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBFcnJvcnNbZXJyb3JzLmNvZGVdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZTogZXJyb3JzLnJlc3BvbnNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvcnMuY29kZSxcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwKFwiQXdzRmlsZVVwbG9hZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9ycy5jb2RlID8gRXJyb3JzW2Vycm9ycy5jb2RlXSA6IGVycm9ycyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgZXJyb3JDb2RlOiAke2NvZGV9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBmZXRjaFNpZ25lZFVybCgpIHtcclxuXHJcbiAgICAgICAgdmFyIHJlcXVlc3RPcHRpb25zLCB1cmwsIGJvZHk7IFxyXG4gICAgICAgIHJlcXVlc3RPcHRpb25zID0gdGhpcy5pc1VwbG9hZE1vZGVNdWx0aXBhcnQgJiYgIHRoaXMub3B0aW9ucy5tdWx0aXBhcnRzaWduZWRVcmxSZXF1ZXN0ID8gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5vcHRpb25zLm11bHRpcGFydHNpZ25lZFVybFJlcXVlc3QpIDogT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5vcHRpb25zLnNpZ25lZFVybFJlcXVlc3QpO1xyXG4gICAgICAgIHVybCA9IHJlcXVlc3RPcHRpb25zLnVybDtcclxuICAgICAgICBib2R5ID0gcmVxdWVzdE9wdGlvbnMuYm9keSB8fCB7fTsgXHJcbiAgICAgICAgaWYgKHRoaXMuaXNVcGxvYWRNb2RlTXVsdGlwYXJ0KSB7XHJcbiAgICAgICAgICAgIGJvZHkucGFydE51bWJlciA9IHRoaXMucGFydE51bWJlcjtcclxuICAgICAgICAgICAgYm9keS51cGxvYWRJZCA9IHRoaXMudXBsb2FkSWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJvZHkuZmlsZU5hbWUgPSB0aGlzLm9wdGlvbnMuZmlsZU5hbWU7XHJcbiAgICAgICAgcmVxdWVzdE9wdGlvbnMuYm9keSA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xyXG4gICAgICAgIGRlbGV0ZSByZXF1ZXN0T3B0aW9ucy51cmw7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKHVybCwgcmVxdWVzdE9wdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmZXRjaFVwbG9hZElkKCl7XHJcbiAgICAgICAgdmFyIHJlcXVlc3RPcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5vcHRpb25zLnVwbG9hZElkUmVxdWVzdCk7XHJcbiAgICAgICAgbGV0IGJvZHkgPSByZXF1ZXN0T3B0aW9ucy5ib2R5IHx8IHt9OyBcclxuICAgICAgICBib2R5LmZpbGVOYW1lID0gdGhpcy5vcHRpb25zLmZpbGVOYW1lO1xyXG4gICAgICAgIHJlcXVlc3RPcHRpb25zLmJvZHkgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcclxuICAgICAgICBkZWxldGUgcmVxdWVzdE9wdGlvbnMudXJsO1xyXG4gICAgICAgIHJldHVybiBmZXRjaCh0aGlzLm9wdGlvbnMudXBsb2FkSWRSZXF1ZXN0LnVybCwgcmVxdWVzdE9wdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb21wbGV0ZU11bHRpcGFydCh1cGxvYWRQYXJ0c0FycmF5KXtcclxuICAgICAgICB2YXIgcmVxdWVzdE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLm9wdGlvbnMuY29tcGxldGVNdWx0aXBhcnRSZXF1ZXN0KTtcclxuICAgICAgICBsZXQgYm9keSA9IHJlcXVlc3RPcHRpb25zLmJvZHkgfHwge307IFxyXG4gICAgICAgIGJvZHkuZmlsZU5hbWUgPSB0aGlzLm9wdGlvbnMuZmlsZU5hbWU7XHJcbiAgICAgICAgYm9keS51cGxvYWRJZCA9IHRoaXMudXBsb2FkSWQ7XHJcbiAgICAgICAgYm9keS5wYXJ0cyA9IHVwbG9hZFBhcnRzQXJyYXk7XHJcbiAgICAgICAgcmVxdWVzdE9wdGlvbnMuYm9keSA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xyXG4gICAgICAgIGRlbGV0ZSByZXF1ZXN0T3B0aW9ucy51cmw7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKHRoaXMub3B0aW9ucy5jb21wbGV0ZU11bHRpcGFydFJlcXVlc3QudXJsLCByZXF1ZXN0T3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgaW5pdCgpIHtcclxuICAgICAgICB2YXIgcmVzcG9uc2UsIGRhdGEsIGJvZHk7XHJcbiAgICAgICAgaWYgKCEodGhpcy5vcHRpb25zIGluc3RhbmNlb2YgT2JqZWN0KSkgdGhyb3cgeyBjb2RlOiAwIH1cclxuICAgICAgICBpZiAoISh0aGlzLm9wdGlvbnMuZmlsZSBpbnN0YW5jZW9mIEZpbGUpKSB0aHJvdyB7IGNvZGU6IDEgfTtcclxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5maWxlTmFtZSkgdGhyb3cgeyBjb2RlOiA5IH07XHJcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuc2lnbmVkVXJsUmVxdWVzdC5oZWFkZXJzKSB0aGlzLm9wdGlvbnMuc2lnbmVkVXJsUmVxdWVzdC5oZWFkZXJzID0ge307XHJcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuc2lnbmVkVXJsUmVxdWVzdC5oZWFkZXJzWydDb250ZW50LXR5cGUnXSkgdGhpcy5vcHRpb25zLnNpZ25lZFVybFJlcXVlc3QuaGVhZGVyc1snQ29udGVudC10eXBlJ10gPSBcImFwcGxpY2F0aW9uL2pzb25cIjtcclxuICAgICAgICB0aGlzLmV2YWx1YXRlSXNNdWx0aXBhcnQoKTtcclxuXHJcblxyXG5cclxuICAgICAgICBpZiAodGhpcy5pc1VwbG9hZE1vZGVNdWx0aXBhcnQpIHtcclxuICAgICAgICAgICAgaWYoIXRoaXMub3B0aW9ucy51cGxvYWRJZFJlcXVlc3QpIHRocm93IHtjb2RlIDogNn1cclxuICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudXBsb2FkSWRSZXF1ZXN0LnVybCkgdGhyb3cgeyBjb2RlOiA3IH07XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLnVwbG9hZElkUmVxdWVzdC5oZWFkZXJzKSB0aGlzLm9wdGlvbnMudXBsb2FkSWRSZXF1ZXN0LmhlYWRlcnMgPSB7fTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudXBsb2FkSWRSZXF1ZXN0LmhlYWRlcnNbJ0NvbnRlbnQtdHlwZSddKSB0aGlzLm9wdGlvbnMudXBsb2FkSWRSZXF1ZXN0LmhlYWRlcnNbJ0NvbnRlbnQtdHlwZSddID0gXCJhcHBsaWNhdGlvbi9qc29uXCI7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZih0aGlzLm9wdGlvbnMubXVsdGlwYXJ0c2lnbmVkVXJsUmVxdWVzdCl7XHJcbiAgICAgICAgICAgICAgICBpZighdGhpcy5vcHRpb25zLm11bHRpcGFydHNpZ25lZFVybFJlcXVlc3QudXJsKSB0aHJvdyB7IGNvZGU6IDEyIH07XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5tdWx0aXBhcnRzaWduZWRVcmxSZXF1ZXN0LmhlYWRlcnMpIHRoaXMub3B0aW9ucy5tdWx0aXBhcnRzaWduZWRVcmxSZXF1ZXN0LmhlYWRlcnMgPSB7fTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLm11bHRpcGFydHNpZ25lZFVybFJlcXVlc3QuaGVhZGVyc1snQ29udGVudC10eXBlJ10pIHRoaXMub3B0aW9ucy5tdWx0aXBhcnRzaWduZWRVcmxSZXF1ZXN0LmhlYWRlcnNbJ0NvbnRlbnQtdHlwZSddID0gXCJhcHBsaWNhdGlvbi9qc29uXCI7XHJcbiAgICAgICAgICAgIH0gXHJcblxyXG4gICAgICAgICAgICBpZighdGhpcy5vcHRpb25zLmNvbXBsZXRlTXVsdGlwYXJ0UmVxdWVzdCkgdGhyb3cge2NvZGUgOiA2fVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5jb21wbGV0ZU11bHRpcGFydFJlcXVlc3QudXJsKSB0aHJvdyB7IGNvZGU6IDcgfTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuY29tcGxldGVNdWx0aXBhcnRSZXF1ZXN0LmhlYWRlcnMpIHRoaXMub3B0aW9ucy5jb21wbGV0ZU11bHRpcGFydFJlcXVlc3QuaGVhZGVycyA9IHt9O1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5jb21wbGV0ZU11bHRpcGFydFJlcXVlc3QuaGVhZGVyc1snQ29udGVudC10eXBlJ10pIHRoaXMub3B0aW9ucy5jb21wbGV0ZU11bHRpcGFydFJlcXVlc3QuaGVhZGVyc1snQ29udGVudC10eXBlJ10gPSBcImFwcGxpY2F0aW9uL2pzb25cIjtcclxuXHJcbiAgICAgICAgICAgIGxldCBudW1PZkNodW5rcyA9IE1hdGguZmxvb3IodGhpcy5vcHRpb25zLmZpbGUuc2l6ZSAvIHRoaXMub3B0aW9ucy5jaHVua1NpemUpICsgMTtcclxuICAgICAgICAgICAgbGV0IHJlc3BvbnNlQXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgbGV0IHVwbG9hZFBhcnRzQXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgbGV0IHN0YXJ0LCBlbmQsIGJsb2I7XHJcblxyXG4gICAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IHRoaXMuZmV0Y2hVcGxvYWRJZCgpXHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT0gMjAwKSB0aHJvdyB7IGNvZGU6IDgsIHJlc3BvbnNlOiByZXNwb25zZSB9O1xyXG4gICAgICAgICAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgICAgICB0aGlzLnVwbG9hZElkID0gZGF0YS5kYXRhLnVwbG9hZElkO1xyXG4gICAgICAgICAgICAvLyAgY2h1bmsgdXBsb2FkXHJcbiAgICAgICAgICAgIGlmICghdGhpcy51cGxvYWRJZCkgdGhyb3cgeyBjb2RlOiA0IH07XHJcbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMTsgaW5kZXggPCBudW1PZkNodW5rcyArIDE7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgICAgIHN0YXJ0ID0gKGluZGV4IC0gMSkgKiB0aGlzLm9wdGlvbnMuY2h1bmtTaXplO1xyXG4gICAgICAgICAgICAgICAgZW5kID0gaW5kZXggKiB0aGlzLm9wdGlvbnMuY2h1bmtTaXplO1xyXG4gICAgICAgICAgICAgICAgYmxvYiA9IGluZGV4IDwgbnVtT2ZDaHVua3MgPyB0aGlzLm9wdGlvbnMuZmlsZS5zbGljZShzdGFydCwgZW5kKSA6IHRoaXMub3B0aW9ucy5maWxlLnNsaWNlKHN0YXJ0KTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFydE51bWJlciA9IGluZGV4O1xyXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmZldGNoU2lnbmVkVXJsKCk7XHJcbiAgICAgICAgICAgICAgICBib2R5ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFib2R5LmRhdGEpIHRocm93IHsgY29kZTogMiwgcmVzcG9uc2U6IHJlc3BvbnNlIH07XHJcbiAgICAgICAgICAgICAgICBpZiAoIWJvZHkuZGF0YS51cmwpIHRocm93IHsgY29kZTogMywgcmVzcG9uc2U6IHJlc3BvbnNlIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNpZ25lZFVybCA9IGJvZHkuZGF0YS51cmw7XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IHRoaXMudXBsb2FkRmlsZShibG9iKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT0gMjAwKSB0aHJvdyB7IGNvZGU6IDUsIHJlc3BvbnNlOiByZXNwb25zZSB9O1xyXG4gICAgICAgICAgICAgICAgcmVzcG9uc2VBcnJheS5wdXNoKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIHVwbG9hZFBhcnRzQXJyYXkucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRVRhZzogcmVzcG9uc2UuaGVhZGVycy5nZXQoXCJldGFnXCIpLnJlcGxhY2VBbGwoJ1wiJywgXCJcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgRVRhZzogcmVzcG9uc2UuaGVhZGVycy5nZXQoXCJldGFnXCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIFBhcnROdW1iZXI6IGluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgIFNpemU6IGJsb2Iuc2l6ZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNvbXBsZXRlTXVsdGlwYXJ0KHVwbG9hZFBhcnRzQXJyYXkpO1xyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9IDIwMCkgdGhyb3cgeyBjb2RlOiAxMCwgcmVzcG9uc2U6IHJlc3BvbnNlIH07XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMub25TdWNjZXNzKSB0aGlzLm9wdGlvbnMub25TdWNjZXNzKHJlc3BvbnNlLCB1cGxvYWRQYXJ0c0FycmF5LCByZXNwb25zZUFycmF5KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy5mZXRjaFNpZ25lZFVybCgpO1xyXG4gICAgICAgICAgICBib2R5ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgICAgICBpZiAoIWJvZHkuZGF0YSkgdGhyb3cgeyBjb2RlOiAyLCByZXNwb25zZTogcmVzcG9uc2UgfTtcclxuICAgICAgICAgICAgaWYgKCFib2R5LmRhdGEudXJsKSB0aHJvdyB7IGNvZGU6IDMsIHJlc3BvbnNlOiByZXNwb25zZSB9O1xyXG4gICAgICAgICAgICB0aGlzLnNpZ25lZFVybCA9IGJvZHkuZGF0YS51cmw7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy51cGxvYWRGaWxlKHRoaXMub3B0aW9ucy5maWxlKTtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPSAyMDApIHRocm93IHsgY29kZTogNSwgcmVzcG9uc2U6IHJlc3BvbnNlIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5vblN1Y2Nlc3MpIHRoaXMub3B0aW9ucy5vblN1Y2Nlc3MocmVzcG9uc2UpXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgdXBsb2FkRmlsZShmaWxlKSB7XHJcbiAgICAgICAgdmFyIG15SGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XHJcbiAgICAgICAgbXlIZWFkZXJzLmFwcGVuZChcIkNvbnRlbnQtVHlwZVwiLCB0aGlzLm9wdGlvbnMuZmlsZS50eXBlKTtcclxuICAgICAgICB2YXIgcmVxdWVzdE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQVVRcIixcclxuICAgICAgICAgICAgaGVhZGVyczogbXlIZWFkZXJzLFxyXG4gICAgICAgICAgICBib2R5OiBmaWxlLFxyXG4gICAgICAgICAgICByZWRpcmVjdDogXCJmb2xsb3dcIixcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBmZXRjaCh0aGlzLnNpZ25lZFVybCwgcmVxdWVzdE9wdGlvbnMpXHJcbiAgICB9XHJcbiAgICBcclxuXHJcbiAgICBldmFsdWF0ZUlzTXVsdGlwYXJ0KCl7XHJcbiAgICAgICAgaWYodGhpcy5vcHRpb25zLm11bHRpcGFydFVwbG9hZCA9PSAnYXV0bycgfHwgdGhpcy5vcHRpb25zLm11bHRpcGFydFVwbG9hZCA9PSB0cnVlKXtcclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jaHVua1NpemUgJiYgdGhpcy5vcHRpb25zLmNodW5rU2l6ZSA8IDYwMDAwMDApIHRocm93IHsgY29kZTogMTEgfTtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmNodW5rU2l6ZSA9IHRoaXMub3B0aW9ucy5jaHVua1NpemUgfHwgMTAwMDAwMDA7IC8vIDEwTUJcclxuICAgICAgICAgICAgdGhpcy5pc1VwbG9hZE1vZGVNdWx0aXBhcnQgPSB0aGlzLm9wdGlvbnMubXVsdGlwYXJ0VXBsb2FkID09ICdhdXRvJyA/ICh0aGlzLm9wdGlvbnMuZmlsZS5zaXplL3RoaXMub3B0aW9ucy5jaHVua1NpemUpID4gMSA6IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbn1cclxuXHJcblxyXG5cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEZpbGVGcm9tVXJsKHVybCwgbmFtZSwgZGVmYXVsdFR5cGUgPSAnaW1hZ2UvanBlZycpIHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsKTtcclxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5ibG9iKCk7XHJcbiAgICByZXR1cm4gbmV3IEZpbGUoW2RhdGFdLCBuYW1lLCB7XHJcbiAgICAgICAgdHlwZTogcmVzcG9uc2UuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpIHx8IGRlZmF1bHRUeXBlLFxyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8vIEF3c0ZpbGVVcGxvYWQuRmlsZSA9IGFzeW5jICgpID0+IHsgcmV0dXJuIGF3YWl0IGdldEZpbGVGcm9tVXJsKCdodHRwczovL2R1bW15aW1hZ2UuY29tL3ZnYScsICdleGFtcGxlLmpwZycpIH07XHJcblxyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQXdzRmlsZVVwbG9hZChvcHRpb25zKSB7XHJcbiAgICBuZXcgX0F3c0ZpbGVVcGxvYWQob3B0aW9ucyk7XHJcbn0iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHRpZihfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdKSB7XG5cdFx0cmV0dXJuIF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0uZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIG1vZHVsZSBleHBvcnRzIG11c3QgYmUgcmV0dXJuZWQgZnJvbSBydW50aW1lIHNvIGVudHJ5IGlubGluaW5nIGlzIGRpc2FibGVkXG4vLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbnJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzOCk7XG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSJdLCJzb3VyY2VSb290IjoiIn0=